/**
 * better-ajaxify: A simple PJAX engine for websites
 * @version 3.0.0-beta.5 Mon, 05 Apr 2021 15:21:07 GMT
 * @link https://github.com/chemerisuk/better-ajaxify
 * @copyright 2021 Maksim Chemerisuk
 * @license MIT
 */
!function(){"use strict";!function(t){function e(t,e,a){t.addEventListener(e,function(t){t.defaultPrevented||a(t)},!1)}function a(t,e,a){var n=r.createEvent("CustomEvent");return n.initCustomEvent("ajaxify:"+e,!0,!0,a||null),t.dispatchEvent(n)}var r=t.document,n=t.location,i=t.history,o=t.fetch,f=t.Request,c=t.URLSearchParams;if(o&&f&&c){var l=new DOMParser,u=[],d={};e(r,"click",function(t){for(var e=r.body,i=t.target;i&&i!==e;i=i.parentNode)if("a"===i.nodeName.toLowerCase()){var o=i.href;if(!i.target&&o&&0===o.indexOf("http")){var c=n.href;o.split("#")[0]!==c.split("#")[0]&&(a(i,"fetch",new f(o)),t.preventDefault())}break}}),e(r,"submit",function(t){var e=t.target,r=e.action;if(!e.target||!r||0===r.indexOf("http")){var n=new FormData(e);if(a(e,"serialize",n)){var i=e.method.toUpperCase()||"GET",o=e.getAttribute("enctype")||e.enctype,l={method:i,headers:{"Content-Type":o}};if("multipart/form-data"===o)l.body=n;else{var u=new c(n);if("GET"===l.method)r+=(~r.indexOf("?")?"&":"?")+u;else if("application/json"!==o)l.body=u.toString();else{var d={};u.forEach(function(t,e){Array.isArray(d[e])?d[e].push(t):e in d?d[e]=[d[e],t]:d[e]=t}),l.body=JSON.stringify(d)}}a(e,"fetch",new f(r,l)),t.preventDefault()}}}),e(r,"ajaxify:fetch",function(t){var e=t.target,r=t.detail;o(r).then(function(t){a(e,"load",t)})["catch"](function(t){if(a(e,"error",t))throw t})}),e(r,"ajaxify:load",function(t){var e=t.target,r=t.detail;r.text().then(function(t){var o=l.parseFromString(t,"text/html");a(e,"render",o)&&(r.url!==n.href.split("#")[0]?i.pushState(u.length,o.title,r.url):i.replaceState(u.length-1,o.title,r.url))})["catch"](function(t){if(a(e,"error",t))throw t})}),e(r,"ajaxify:render",function(t){var e=t.target,n=t.detail;d.body=r.body,d.title=r.title,u.indexOf(d)>=0?d=n:(u.push(d),d={}),a(e,"update",n)}),e(r,"ajaxify:update",function(t){var e=t.detail;r.documentElement.replaceChild(e.body,r.body),r.title=e.title}),e(t,"popstate",function(t){var e=t.state;if("number"==typeof e){var i=u[e];i?a(r,"render",i):a(r,"fetch",new f(n.href))}}),i.replaceState(0,r.title)}}(window)}();